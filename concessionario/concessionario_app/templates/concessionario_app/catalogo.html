{% extends 'base.html' %}
{% load static %}
{% block title %} Catalogo Auto {% endblock %}
{% block content %}
    <div class="layout-on-top">
        {% if user.is_authenticated %}
            <h1 class="welcome-text">Benvenuto {{user.username}}!</h1>
        {% else %}
            <h1 class="welcome-text">Benvenuto al concessionario!</h1>
        {% endif %}
        
        <div class="filtri-wrapper">
            <div class="filtri-toggle" id="toggle-filtri">
                <span>Filtri</span>
            </div>
            
            <div class="filtri-dropdown">
                <form method="get" class="filtri-form">
                    <div class="contenuto-filtri">
                        <p>
                            {{ form.marca }}
                        </p>
                        <p>
                            {{ form.categoria }}
                        </p>
                        <p>
                            {{ form.alimentazione }}
                        </p>
                        <p>
                            {{ form.condizioni }}
                        </p>
                        <p class="prezzo-wrapper">
                            {{ form.prezzo_min.label_tag }}
                            {{ form.prezzo_min }}
                        </p>
                        <p class="prezzo-wrapper">
                            {{ form.prezzo_max.label_tag }}
                            {{ form.prezzo_max }}
                        </p>
                        <div class="filtri-actions">
                            <button type="submit" class="btn-filtra">Filtra</button>
                            <a href="{% url 'catalogo' %}" class="btn-reset">Reset</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        const toggle = document.getElementById("toggle-filtri");
        const dropdown = document.querySelector(".filtri-dropdown");
        const wrapper = document.querySelector(".filtri-wrapper");
        const layout = document.querySelector(".layout-on-top");
    
        toggle.addEventListener("click", () => {
            wrapper.classList.toggle("aperto");
            layout.classList.toggle("aperto");
        });

        document.querySelectorAll('.prezzo-wrapper input').forEach(input => {
            const wrapper = input.closest('.prezzo-wrapper');

            function toggleEuro() {
                wrapper.classList.toggle('has-value', input.value.trim() !== '');
            }

            input.addEventListener('input', toggleEuro);
            toggleEuro();
        });

    </script>
    
    <h2>
        <a href="?order={{ next_order }}" style="text-decoration: none; color: inherit; cursor: pointer;">
            Auto ordinate per: {{ order_label }}
        </a>
    </h2>
    {% if nuove %}
    <div class="carousel">
        <div class="carousel__inner">
            {% for a in nuove %}
            <div class="carousel__box">
                <a href="{% url 'dettaglio_auto' a.pk %}">
                    {% if a.foto_set.first %}
                        <img src="{{ a.foto_set.first.foto.url }}" alt="{{ a.marca }} {{ a.modello }}">
                    {% else %}
                        <p>üì∑ Nessuna foto</p>
                    {% endif %}
                </a>
                <p>{{ a.marca }} {{ a.modello }} - ‚Ç¨{{ a.prezzo }}</p>
                <form method="post" action="{% url 'toggle_preferito' a.pk %}">
                    {% csrf_token %}
                    <button type="submit">
                        {% if a.pk in preferiti_ids %}
                            ‚ù§Ô∏è
                        {% else %}
                            ü§ç
                        {% endif %}
                    </button>
                </form>
            </div>
            {% endfor %}
        </div>
        <button type="button" class="carousel__control carousel__control--left">
            <i class="fa fa-angle-left"></i>
        </button>
        <button type="button" class="carousel__control carousel__control--right">
            <i class="fa fa-angle-right"></i>
        </button>
    </div>
    {% else %}
    <p>Nessuna auto disponibile al momento.</p>
    {% endif %}
    <h2>Le pi√π amate</h2>
    {% include "concessionario_app/carousel_preferite.html" %}
{% endblock %}